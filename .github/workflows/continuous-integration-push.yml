name: Continuos Integration

on: [push]

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Code Checkout
              uses: actions/checkout@v1

            - name: Set up JDK 1.11
              uses: actions/setup-java@v1
              with:
                  java-version: 1.11

            - name: Maven Test
              run: mvn clean test
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Cache SonarCloud packages
              uses: actions/cache@v1
              with:
                  path: ~/.sonar/cache
                  key: ${{ runner.os }}-sonar
                  restore-keys: ${{ runner.os }}-sonar

            - name: SonarScan
              run: mvn verify org.sonarsource.scanner.maven:sonar-maven-plugin:sonar
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                  SONAR_TOKEN: 8a223db1cbef745be8e616249f701821a7dccb46
